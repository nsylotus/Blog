## 软件是如何访问硬件的

硬件在输入输出上大体分为串行和并行，相应的接口也就是串行接口和并行接口。串行硬件通过串行接口与 CPU 通信，反过来也是， CPU 通过串行接口与串行设备数据传输。并行设备的访问类似，只不过是通过并行接口进行的。

访问外部硬件有两个方式：

1. 将某个外设的内存映射到一定范围的地址空间中， CPU 通过地址总线访问该内存区域时会落到外设的内存中，这种映射让 CPU 访问外设的内存就如同访问主板上的物理内存样。有的设备是这样做的，比如显卡，显卡是显示器的适配器， CPU 不直接和显示器交互，它只和显卡通信。显卡上有片内存叫显存，它被映射到主机物理内存上的低端 1MB 的0xB8000～0xBFFFFCPU 访问这片内存就是访问显存，住这片内存上写字节便是往屏幕上打印内容。

2. 外设是通过IO接口与CPU通信的，CPU访问外设，就是访问IO接口，由IO接口将信息传递给另一端的外设，也就是说，CPU从来不知道有这些设备的存在，它只知道自己操作的IO接口。

如何访问到 IO 接口呢，答案就是 IO 接口上面有一些寄存器，访问IO接口本质上就是访问这些寄存器。

## 应用程序是什么？和操作系统是如何配合到一起的

应用程序是软件，操作系统也是软件。

CPU只知道去CS: IP寄存器中指向的内存取指令井执行，它不知道什么是操作系统，也无需知道。

编译器提供了一套库函数，库函数中又有封装的系统调用，这样的代码集合称之为运行库。C语言的运行库称为C运行库，就是所谓的 CRT ( C Runtime Library ）。

应用程序加上操作系统提供功能才算是完整的程序。

需要调用操作系统提供好的函数才能完整地做成一件事，而这个函数便是系统调用。

用户态与内核态是对 CPU 来讲的，是指 CPU 运行在用户态（特权3级）还是内核态（特权0级）。

用户进程陷入内核态是指：由于内部或外部中断发生，当前进程被暂时终止执行，其上下文被内核的中断程序保存起来后，开始执行一段内核的代码。

当应用程序陆入内核后，它自己已经下 CPU 了，以后发生的事，应用程序完全不知道，它的上下文环境己经被保存到自己的0特权级栈中了，那时在 CPU 上运行的程序己经是内核程序了。

系统调用子功能号，该子功能号用寄存器eax寄存器存储。

应用程序处于特权级3，操作系统内核处于特权级0。当用户程序欲访问系统资源时（无论是硬件，还是内核数据结构）它需要进行系统调用。这样 CPU 便进入了内核态，也称管态。

## 内存访问为什么要分段

