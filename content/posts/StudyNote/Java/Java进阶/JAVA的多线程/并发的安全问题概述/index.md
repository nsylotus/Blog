---
title: "JAVA并发的安全问题概述" # 文章标题.
date: 2022-06-29
draft: false
tags: ["JAVA"]
categories: ["JAVA"]
---

### 并发的安全问题概述

1. 什么时候数据在多线程并发的环境下会存在安全问题呢？

   1. 三个条件：
      1. 条件1：多线程并发。
      2. 条件2：有共享数据。
      3. 条件3：共享数据有修改的行为。
      4. 满足以上3个条件之后，就会存在线程安全问题。

2. 怎么解决线程安全问题呢？

   1. 当多线程并发的环境下，有共享数据，并且这个数据还会被修改，此时就存在线程安全问题，怎么解决这个问题？
      1. 线程排队执行。（不能并发）。用排队执行解决线程安全问题。这种机制被称为：**线程同步机制。**
      2. 专业术语叫做：线程同步，实际上就是线程不能并发了，线程必须排队执行。
   2. 怎么解决线程安全问题呀？使用“线程同步机制”。

3. 线程同步就是线程排队了，线程排队了就会牺牲一部分效率，没办法，数据安全第一位，只有数据安全了，我们才可以谈效率。数据不安全，没有效率的事儿。

4. 说到线程同步这块，涉及到这两个专业术语：

   1. 异步编程模型：

      线程t1和线程t2，各自执行各自的，t1不管t2，t2不管t1，谁也不需要等谁，这种编程模型叫做：异步编程模型。其实就是：多线程并发（效率较高。）**异步就是并发。**

   2. 同步编程模型：

      线程t1和线程t2，在线程t1执行的时候，必须等待t2线程执行结束，或者说在t2线程执行的时候，必须等待t1线程执行结束，两个线程之间发生了等待关系，这就是同步编程模型。效率较低。线程排队执行。**同步就是排队。**

5. **Java中的三大变量与线程的问题？**

   1. 成员变量：

      1. 实例变量：在堆中。
      2. 静态变量：在方法区。

   2. 局部变量：在栈中。

   3. 以上三大变量中：

      局部变量永远都不会存在线程安全问题。因为局部变量不共享。**（一个线程一个栈。）**局部变量在栈中。所以局部变量永远都不会共享。

      实例变量在堆中，堆只有1个。静态变量在方法区中，方法区只有1个。堆和方法区都是多线程共享的，所以可能存在线程安全问题。

   4. 局部变量+常量：不会有线程安全问题。

   5. 成员变量：可能会有线程安全问题。

6. 局部变量对于线程安全的类与线程不安全的类如何选择：

   1. 对于StringBuilder和StringBuffer类：

      建议使用：StringBuilder。因为局部变量不存在线程安全问题。选择StringBuilder。StringBuffer效率比较低。

   2. ArrayList是非线程安全的。

   3. Vector是线程安全的。

   4. HashMap与HashSet是非线程安全的。

   5. Hashtable是线程安全的。
   
7. 以后开发中应该怎么解决线程安全问题？

   1. 是一上来就选择线程同步吗？使用synchronized吗？

      不是，synchronized会让程序的执行效率降低，用户体验不好。系统的用户吞吐量降低。用户体验差。在不得已的情况下再选择线程同步机制。

   2. 解决方案：

      1. 第一种方案：尽量使用局部变量代替“实例变量和静态变量”。
      2. 第二种方案：如果必须是实例变量，那么可以考虑创建多个对象，这样实例变量的内存就不共享了。（一个线程对应1个对象，100个线程对应100个对象，对象不共享，就没有数据安全问题了。）
      3. 第三种方案：如果不能使用局部变量，对象也不能创建多个，这个时候就只能选择synchronized了。线程同步机制。
